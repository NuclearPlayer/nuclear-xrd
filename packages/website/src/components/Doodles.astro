---
import Doodle from './Doodle.astro';

type DoodleType = 'spark' | 'star' | 'lightning' | 'x' | 'squiggle' | 'twist' | 'spiral';

type DoodleConfig = {
  type: DoodleType;
  style: string;
  class: string;
};

type Props = {
  variant?: 'hero' | 'cta' | 'sparse' | 'scattered' | 'scattered-white';
  count?: number;
};

const { variant = 'hero', count = 12 } = Astro.props;

const doodleTypes: DoodleType[] = [
  'spark',
  'star',
  'lightning',
  'x',
  'squiggle',
  'twist',
  'spiral',
];

const randomBetween = (min: number, max: number) =>
  Math.random() * (max - min) + min;
const randomInt = (min: number, max: number) =>
  Math.floor(randomBetween(min, max));
const pick = <T,>(arr: T[]): T => arr[randomInt(0, arr.length)];

const generateScatteredDoodles = (
  n: number,
  colorClasses: string[],
): DoodleConfig[] => {
  const doodles: DoodleConfig[] = [];
  const sizes = [
    'w-12 md:w-16',
    'w-14 md:w-20',
    'w-16 md:w-24',
    'w-20 md:w-28',
    'w-24 md:w-32',
    'w-28 md:w-36',
  ];

  for (let i = 0; i < n; i++) {
    const top = randomBetween(5, 90);
    const left = randomBetween(2, 92);
    const rotation = randomBetween(-45, 45);

    doodles.push({
      type: pick(doodleTypes),
      style: `top: ${top.toFixed(1)}%; left: ${left.toFixed(1)}%; transform: rotate(${rotation.toFixed(0)}deg);`,
      class: `${pick(sizes)} ${pick(colorClasses)}`,
    });
  }

  return doodles;
};

const heroDoodles: DoodleConfig[] = [
  {
    type: 'spark',
    style: '',
    class: 'w-10 md:w-14 text-accent-purple top-[3%] left-[5%] rotate-12',
  },
  {
    type: 'star',
    style: '',
    class: 'w-6 md:w-10 text-accent-orange top-[8%] right-[8%] -rotate-6',
  },
  {
    type: 'x',
    style: '',
    class: 'w-5 md:w-7 text-accent-cyan top-[25%] left-[2%] rotate-45',
  },
  {
    type: 'lightning',
    style: '',
    class: 'w-8 md:w-12 text-primary top-[45%] right-[3%] rotate-[-20deg]',
  },
  {
    type: 'squiggle',
    style: '',
    class: 'w-16 md:w-24 text-accent-purple/40 bottom-[35%] left-[4%] rotate-6',
  },
  {
    type: 'twist',
    style: '',
    class:
      'w-8 md:w-12 text-accent-orange/60 bottom-[15%] right-[6%] -rotate-12',
  },
  {
    type: 'star',
    style: '',
    class: 'w-5 md:w-8 text-primary/50 top-[60%] left-[8%] rotate-[30deg]',
  },
  {
    type: 'spark',
    style: '',
    class:
      'w-6 md:w-9 text-accent-cyan/50 bottom-[8%] left-[15%] -rotate-[15deg]',
  },
  {
    type: 'x',
    style: '',
    class: 'w-4 md:w-6 text-accent-orange/40 top-[35%] right-[12%] rotate-12',
  },
  {
    type: 'spiral',
    style: '',
    class:
      'w-12 md:w-16 text-accent-purple/30 bottom-[5%] right-[20%] rotate-[60deg]',
  },
  {
    type: 'lightning',
    style: '',
    class: 'w-6 md:w-9 text-accent-cyan/40 top-[12%] left-[25%] rotate-[10deg]',
  },
  {
    type: 'twist',
    style: '',
    class: 'w-6 md:w-10 text-primary/30 top-[70%] right-[15%] rotate-[-30deg]',
  },
];

const ctaDoodles: DoodleConfig[] = [
  {
    type: 'spark',
    style: '',
    class: 'w-14 md:w-20 text-white/25 top-[8%] left-[3%] rotate-12',
  },
  {
    type: 'star',
    style: '',
    class: 'w-10 md:w-14 text-white/20 top-[15%] right-[5%] -rotate-6',
  },
  {
    type: 'lightning',
    style: '',
    class: 'w-12 md:w-16 text-white/20 bottom-[20%] left-[8%] rotate-[-15deg]',
  },
  {
    type: 'spiral',
    style: '',
    class: 'w-16 md:w-24 text-white/15 bottom-[10%] right-[3%] rotate-45',
  },
  {
    type: 'x',
    style: '',
    class: 'w-8 md:w-12 text-white/15 top-[50%] left-[15%] rotate-[20deg]',
  },
  {
    type: 'squiggle',
    style: '',
    class: 'w-20 md:w-28 text-white/10 top-[30%] right-[15%] -rotate-12',
  },
  {
    type: 'twist',
    style: '',
    class: 'w-10 md:w-14 text-white/20 bottom-[35%] right-[25%] rotate-[30deg]',
  },
  {
    type: 'star',
    style: '',
    class: 'w-6 md:w-10 text-white/15 bottom-[50%] left-[25%] rotate-[-20deg]',
  },
];

const sparseDoodles: DoodleConfig[] = [
  {
    type: 'star',
    style: '',
    class: 'w-6 md:w-8 text-primary/30 top-[15%] right-[8%] rotate-12',
  },
  {
    type: 'x',
    style: '',
    class: 'w-5 md:w-6 text-accent-purple/25 bottom-[25%] left-[5%] -rotate-6',
  },
  {
    type: 'spark',
    style: '',
    class:
      'w-6 md:w-8 text-accent-orange/25 top-[50%] left-[3%] rotate-[25deg]',
  },
  {
    type: 'twist',
    style: '',
    class:
      'w-8 md:w-10 text-accent-cyan/20 bottom-[10%] right-[10%] -rotate-[15deg]',
  },
];

const scatteredColors = [
  'text-accent-purple',
  'text-accent-orange',
  'text-accent-cyan',
  'text-primary',
];

const scatteredWhiteColors = ['text-white'];

const getDoodles = (): DoodleConfig[] => {
  switch (variant) {
    case 'hero':
      return heroDoodles;
    case 'cta':
      return ctaDoodles;
    case 'sparse':
      return sparseDoodles;
    case 'scattered':
      return generateScatteredDoodles(count, scatteredColors);
    case 'scattered-white':
      return generateScatteredDoodles(count, scatteredWhiteColors);
    default:
      return heroDoodles;
  }
};

const doodles = getDoodles();
---

<div
  class="doodles-container absolute inset-0 pointer-events-none overflow-hidden z-1"
  aria-hidden="true"
>
  {
    doodles.map((doodle) => (
      <div class:list={['absolute', doodle.class]} style={doodle.style}>
        <Doodle type={doodle.type} />
      </div>
    ))
  }
</div>
